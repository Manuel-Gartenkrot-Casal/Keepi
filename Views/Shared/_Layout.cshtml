@{
    // Obtener el string de sesi√≥n
    string user = Context.Session.GetString("usuario");
    Usuario usuario = null;
    string nombreDeUsuario = "SinSesion";

    if (!string.IsNullOrEmpty(user))
    {
        usuario = Objeto.StringToObject<Usuario>(user);
        nombreDeUsuario = usuario.Username;
    }
}

<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <title>@ViewData["Title"] - Keepi</title>

    <link rel="stylesheet" href="~/css/style.css" asp-append-version="true" />

    <!-- Favicon principal -->
    <link rel="icon" type="image/png" href="~/imagenes/keepi.png">
    <link rel="apple-touch-icon" href="~/imagenes/icon-192x192.png">
    <link rel="icon" type="image/png" href="~/imagenes/favicon-32x32.png" sizes="32x32" />
    <link rel="icon" type="image/png" href="~/imagenes/favicon-16x16.png" sizes="16x16" />

    <link rel="manifest" href="~/manifest.json">
    <meta name="theme-color" content="#59ad44">
</head>

<body>

    <!-- Overlay -->
    <div class="overlay" id="overlay"></div>

    <!-- Men√∫ Lateral -->
    <div class="menu-lateral" id="menuLateral">
        <div class="menu-lateral-header">
            <h2>Men√∫</h2>
            <button class="btn-cerrar" id="btnCerrar">√ó</button>
        </div>

        <nav>
            @if (!string.IsNullOrEmpty(user))
            {
                <a href="/Home/Index"><span>üè†</span> Inicio</a>
                <a href="/Heladera/Heladeras"><span>‚¨ú</span> Heladeras</a>
                <a href="/Recetas"><span>üçΩÔ∏è</span> Recetas</a>
                <a href="/Chat/ChatBot"><span>üí¨</span> Mr. Keep</a>
            }
            else
            {
                <a href="/Home/Index"><span>üè†</span> Inicio</a>
            }
        </nav>
    </div>

    <!-- Notificaciones -->
    @await Component.InvokeAsync("Notificaciones")

    <!-- Header -->
    <header>
        <section class="layout">
            <div class="grow1">
                <a class="menu" href="#" id="btnMenu">‚ò∞</a>
            </div>

            <div class="grow9">
                <a class="logo" href="/Home/Index">
                    <img src="~/imagenes/logokeepi.png" alt="Logo Keepi">
                </a>
            </div>

            <div class="grow1">

                <a class="notis" href="/Notificaciones/Panel">
                    <img src="~/imagenes/Notis.png" alt="Notificaciones" id="btnNoti">
                </a>

                @if (nombreDeUsuario != "SinSesion")
                {
                    <p class="nombreDeUsuarioHeader">@nombreDeUsuario</p>
                }

                <a class="perfil" href="/Home/Perfil">
                    <img src="~/imagenes/Perfil.png" alt="Perfil">
                </a>
            </div>
        </section>
    </header>

    <script>
        const btnMenu = document.getElementById('btnMenu');
        const btnCerrar = document.getElementById('btnCerrar');
        const menuLateral = document.getElementById('menuLateral');
        const btnNoti = document.getElementById('btnNoti');
        const panel = document.getElementById('panel');
        const btnCerrarPanel = document.getElementById('btnCerrarPanel');
        const overlay = document.getElementById('overlay');

        // Abrir men√∫
        btnMenu.addEventListener('click', (e) => {
            e.preventDefault();
            menuLateral.classList.add('active');
            overlay.classList.add('active');
        });

        // Cerrar men√∫ con bot√≥n X
        btnCerrar.addEventListener('click', () => {
            menuLateral.classList.remove('active');
            overlay.classList.remove('active');
        });

        // Cerrar men√∫ al hacer clic en overlay
        overlay.addEventListener('click', () => {
            menuLateral.classList.remove('active');
            if (panel) panel.classList.remove('active');
            overlay.classList.remove('active');
        });

        // Cerrar men√∫ al hacer clic en un enlace
        const menuLinks = document.querySelectorAll('.menu-lateral nav a');
        menuLinks.forEach(link => {
            link.addEventListener('click', () => {
                menuLateral.classList.remove('active');
                overlay.classList.remove('active');
            });
        });

        // Notificaciones panel (si existe)
        if (btnNoti && panel && btnCerrarPanel) {
            btnNoti.addEventListener('click', (e) => {
                e.preventDefault();
                panel.classList.add('active');
                overlay.classList.add('active');
            });

            btnCerrarPanel.addEventListener('click', () => {
                panel.classList.remove('active');
                overlay.classList.remove('active');
            });

            const notisLinks = document.querySelectorAll('.notificaciones-panel ul li a');
            notisLinks.forEach(link => {
                link.addEventListener('click', () => {
                    panel.classList.remove('active');
                    overlay.classList.remove('active');
                });
            });
        }
    </script>

    <main role="main">
        @RenderBody()
    </main>

    <footer>
        <p>¬© @DateTime.Now.Year Keepi ‚Äî Don't Waste It, Keepi.</p>
    </footer>

    <!-- Chat widget -->
    <div id="chat-widget" class="chat-widget">
        <div class="chat-widget-header">
            <span>üí¨ Mr. Keep</span>
            <button id="close-chat-widget" aria-label="Cerrar chat">√ó</button>
        </div>

        <div id="chat-widget-messages" class="chat-widget-messages"></div>

        <div class="chat-widget-input-area">
            <input type="text" id="chat-widget-input" placeholder="Escribe tu mensaje..." maxlength="1000" aria-label="Mensaje">
            <button id="chat-widget-send" aria-label="Enviar mensaje">‚û§</button>
        </div>
    </div>

    <button id="chat-fab" class="chat-fab" aria-label="Abrir chat">üí¨</button>

    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="~/js/site.js" asp-append-version="true"></script>

    <script>
        // Detectar si es dispositivo t√°ctil
        const isTouchDevice = 'ontouchstart' in window || navigator.maxTouchPoints > 0;
        if (isTouchDevice) document.body.classList.add('touch-device');
    </script>

    @await RenderSectionAsync("Scripts", required: false)

</body>
</html>
